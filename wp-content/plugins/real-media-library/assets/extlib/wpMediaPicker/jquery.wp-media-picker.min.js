/*! real-media-library 16-01-2018 */

!function(e,t){if(void 0!==window.wp&&void 0!==window.wp.media&&void 0!==window.wp.media.editor){var n=t.media.editor.send.attachment,i=window.send_to_editor,o=function(e){var t=window.wpActiveEditor;document.getElementById(t).innerHTML=e,window.send_to_editor=i};t.media.editor.send.attachment=function(i,a){var s;if(0===(s=t.media.editor.activeEditor?t.media.editor.activeEditor:window.wpActiveEditor||"").search("wp-mediapicker-content-")){var r=s.substring("wp-mediapicker-content-".length);return window.send_to_editor=o,e("#"+r).wpMediaPicker("sendAttachment",a)}return n.apply(this,[i,a])};var a={options:{store:"id",query:{},filterable:"all",searchable:!0,editable:!1,allowLocalEdits:!1,displaySettings:!1,displayUserSettings:!1,change:!1,htmlChange:!1,onClose:!1,onShow:!1,clear:!1,label_add:t.media.view.l10n.addMedia,label_replace:t.media.view.l10n.replace,label_remove:t.media.view.l10n.remove,label_modal:t.media.view.l10n.addMedia,label_button:t.media.view.l10n.addMedia},_create:function(){var n=this;e.extend(n.options,n.element.data()),n.content_id="wp-mediapicker-content-"+n.element.attr("id"),n.element.hide().wrap('<div class="wp-mediapicker-container" />'),n.wrap=n.element.parent(),n.open_button=e('<a class="wp-mediapicker-open-button button" />').insertAfter(n.element),n.remove_button=e('<a class="wp-mediapicker-remove-button" style="cursor:pointer;" />').insertAfter(n.open_button).text(n.options.label_remove),n.content_wrap=e('<div class="wp-mediapicker-content-wrap" />').insertAfter(n.remove_button),n.content=e('<div class="wp-mediapicker-content" />').appendTo(n.content_wrap).attr("id",n.content_id),n.workflow=t.media.editor.add(n.content_id,{frame:"select",state:"insert",states:[new t.media.controller.Library({id:"insert",title:n.options.label_modal,priority:20,toolbar:"select",filterable:n.options.filterable,library:t.media.query(n.options.query),multiple:!1,syncSelection:!0,editable:n.options.editable,allowLocalEdits:n.options.allowLocalEdits,displaySettings:n.options.displaySettings,displayUserSettings:n.options.displayUserSettings})],button:{event:"insert",text:n.options.label_button}}),n.workflow.on("close",function(){"function"==typeof n.options.onClose&&setTimeout(function(){n.options.onClose(n)}.bind(this),100)}.bind(this)),n._updateContent(),n._addListeners()},_addListeners:function(){var e=this;e.open_button.on("click",function(t){t.preventDefault(),e.workflow.state("insert").get("selection").reset(e.attachment?[e.attachment]:[]),e.open(),"function"==typeof e.options.onShow&&setTimeout(function(){e.options.onShow(e)}.bind(this),100)}),e.remove_button.on("click",function(t){t.preventDefault(),e.element.val(null),e._resetContent(),"function"==typeof e.options.clear&&e.options.clear.call(e)})},_createContent:function(e,t){var n=this;n.attachment=e,n.open_button.text(n.options.label_replace),n.remove_button.show();var i="";if("image"===e.type){var o=e.url;e.sizes&&e.sizes.large?o=e.sizes.large.url:e.sizes&&e.sizes.full&&(o=e.sizes.full.url),i+='<img src="'+o+'" alt="'+e.alt+'" />'}else if("video"===e.type){var a="";e.image&&e.image.src!==e.icon&&(a=e.image.src),i+='<video class="wp-video-shortcode" preload="metadata"'+(a?' poster="'+a+'"':"")+' controls><source type="'+e.mime+'" src="'+e.url+'" /></video>'}else"audio"===e.type?(e.image&&e.image.src&&e.image.src!==e.icon?i+='<img class="wp-audio-cover" src="'+e.image.src+'" alt="'+e.filename+'" />':i+='<div class="mime-type-icon"><img src="'+e.icon+'" /><span>'+e.filename+"</span></div>",i+='<audio class="wp-audio-shortcode" width="100%" preload="none" controls><source type="'+e.mime+'" src="'+e.url+'" /></audio>'):i+='<div class="mime-type-icon"><img src="'+e.icon+'" /><span>'+e.filename+"</span></div>";if(0<=i.search("<img ")?n.content.addClass("size-auto"):n.content.removeClass("size-auto"),n.content.show(),t)return"function"==typeof n.options.htmlChange&&setTimeout(function(){n.options.htmlChange(n.content,this)}.bind(this),500),i;n.content.html(i),"function"==typeof n.options.htmlChange&&n.options.htmlChange(n.content,this)},_resetContent:function(){var e=this;e.attachment=null,e.open_button.text(e.options.label_add),e.remove_button.hide(),e.content.hide().empty().removeClass("size-auto"),"function"==typeof e.options.htmlChange&&e.options.htmlChange(e.content,this)},_updateContent:function(){var e=this,n=e.element.val();n?"url"===e.options.store?t.media.ajax({type:"POST",data:{action:"get-attachment-by-url",url:n},success:function(t){e._createContent(t)},error:function(){e.element.val(null),e._resetContent()}}):t.media.ajax({type:"POST",data:{action:"get-attachment",id:parseInt(n,10)},success:function(t){e._createContent(t)},error:function(){e.element.val(null),e._resetContent()}}):(e.element.val(null),e._resetContent())},sendAttachment:function(e){var t=this;"url"===t.options.store?t.element.val(e.url):t.element.val(e.id);var n=t._createContent(e,!0);return"function"==typeof t.options.change&&t.options.change.call(t),n},open:function(){t.media.editor.open(this.content_id)},close:function(){this.workflow.close()},attachment:function(e){if(void 0===e)return this.attachment;e?("url"===this.options.store?this.element.val(e.url):this.element.val(e.id),this._createContent(e)):(this.element.val(null),this._resetContent())},value:function(e){if(void 0===e)return this.attachment?"url"===this.options.store?this.attachment.url:this.attachment.id:"";this.element.val(e),this._updateContent()}};e.widget("wp.wpMediaPicker",a)}else e.fn.wpMediaPicker=function(){return this}}(jQuery,window.wp);